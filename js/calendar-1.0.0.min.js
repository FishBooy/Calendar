!function(a){var b=function(b,c,d){this.index=b,this.handle=c,this.opts=a.extend(!1,this.defaultOpts,d||{}),this.now=new Date,this.setData(this.now),this.calendar=null,this.createBodyHtml(),this.createHeadHtml(this.staticData.days),this.inserstHtml(),this.tdEvents(),this.prevNext()};b.prototype.defaultOpts={theme:"green",language:"en",addH:10},b.prototype.staticData={days:["Sun","Mon","Tue","Wen","Thu","Fri","Sat"],months:["Febuary","January","March","April","May","June","July","August","September","October","November","December"],months_31:[1,3,5,7,8,10,12],yue:["一","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],tHead:"<thead><tr>"},b.prototype.setData=function(a){this.curYear=a.getFullYear(),this.curMonth=a.getMonth(),this.curDate=a.getDate(),this.curDay=a.getDay(),this.firstDay=new Date(a.setDate(1)).getDay(),this.curDays=this.daysConfirm(this.staticData.months_31,this.curMonth+1,this.curYear),this.prevDays=this.daysConfirm(this.staticData.months_31,this.curMonth,this.curYear),this.rows=Math.ceil((this.curDays-(7-this.firstDay))/7),this.tBody="",this.init=1},b.prototype.daysConfirm=function(a,b,c){return b=b?b:12,c=b?c:c--,totalDays=2==b?!c%4||!c%400?c%100?28:29:28:-1!=a.join().indexOf(b)?31:30},b.prototype.createTitleHtml=function(){return'<h2><a href=""><</a><p><span class="m">'+this.staticData.months[this.curMonth]+'</span> - <span class="y">'+this.curYear+'</span></p><a href="">></a></h2>'},b.prototype.createHeadHtml=function(a){if(-1==this.staticData.tHead.indexOf("Fri"))for(var b=0;b<a.length;b++)this.staticData.tHead+="<th>"+a[b]+"</th>",b==a.length-1&&(this.staticData.tHead+="</tr></thead>")},b.prototype.createBodyHtml=function(a){var b,c,d,e;for(a=a?"past":"",b=0;b<this.rows+1;b++){for(c="<tr>",d=0;d<this.staticData.days.length;d++)e=7*(b+1)-this.firstDay-(7-(d+1)),c+=e>this.curDays?'<td class="nextMonth">'+(e-this.curDays)+"</td>":e==this.curDate&&this.init?'<td class="today">'+e+"</td>":0>=e?'<td class="prevMonth">'+(this.prevDays+e)+"</td>":e<this.curDate?'<td class="past">'+e+"</td>":'<td class="'+a+'">'+e+"</td>";c+="</tr>",this.tBody+=c}},b.prototype.inserstHtml=function(){var b="<table>"+this.staticData.tHead+this.tBody+"</table>",c=this.handle.offset(),d=this.handle.outerHeight(),e=this.opts.theme==this.defaultOpts.theme?"":"cal-the-"+this.opts.theme;this.calendar=a("<div>"+this.createTitleHtml()+b+"</div>").css({left:c.left,top:c.top+d+this.opts.addH}).appendTo(a("body")).addClass("calendar-box "+e).attr("id","calendar-"+this.opts.theme+"-"+this.index)},b.prototype.tdEvents=function(){var b=this,c="td:not(.prevMonth):not(.nextMonth):not(.past)";this.calendar.on("click","td,h2,th",function(a){a.stopPropagation()}).on("mouseover",c,function(){a(this).addClass("hover")}).on("mouseleave",c,function(){a(this).removeClass("hover")}).on("click",c,function(){var c=new Date(b.curMonth+1+"/"+a(this).text()+"/"+b.curYear),d=b.curYear+"-"+(b.curMonth+1)+"-"+a(this).text()+"-"+b.staticData.days[c.getDay()];b.handle.val(d),b.calendar.hide()})},b.prototype.prevNext=function(){var b=this;a.each(a("h2 a",this.calendar),function(c,d){c?a(d).addClass("next-btn"):a(d).addClass("prev-btn"),a(d).click(function(c){c.preventDefault(),c.stopPropagation();var d;a(this).hasClass("next-btn")?b.curMonth==b.staticData.months.length-1?(d=1,b.curYear++):d=b.curMonth+1+1:0==b.curMonth?(d=b.staticData.months.length,b.curYear--):d=b.curMonth,b.reSet(d,b.curYear)})})},b.prototype.reSet=function(b,c,d){var e=new Date;this.curMonth==e.getMonth()&&this.curYear==e.getFullYear()&&d||(this.now=d?new Date:new Date(b+"/"+"1/"+c),this.setData(this.now),a(".m",this.calendar).text(this.staticData.months[this.curMonth]),a(".y",this.calendar).text(this.curYear),past=this.curYear<e.getFullYear()?1:this.curYear==e.getFullYear()?this.curMonth<e.getMonth()?1:0:0,this.curMonth!=e.getMonth()||this.curYear!=e.getFullYear()?this.init=0:this.curDate=e.getDate(),this.createBodyHtml(past),a("tbody",this.calendar).remove(),a("table",this.calendar).append(this.tBody))},a.fn.calendar=function(c){var d=this;return this.click(function(e){var f,g,h,i,j;e.stopPropagation(),f=d.index(a(this))+1,g=a(this).data("calendar"),g?(h=g.calendar,i=new Date,a(".calendar-box").not(h).hide(),"none"==h.css("display")?(g.reSet(i.getMonth(),i.getFullYear(),1),h.show()):h.hide()):(a(".calendar-box").hide(),a(document).click(function(){a(".calendar-box").hide()}),j=new b(f,a(this),c),a(this).data("calendar",j))})}}(jQuery);